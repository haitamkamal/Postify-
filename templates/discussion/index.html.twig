{% extends 'base.html.twig' %}

{% block title %}Discussion avec
	{{ member.username }}
{% endblock %}

{% block body %}
	<h2 style="text-align: center; margin-bottom: 10px;">
		Discussion avec
		{{ member.username }}
	</h2>

	<div
		style="max-width: 600px; margin: 0 auto; border: 1px solid #ccc; border-radius: 10px; height: 80vh; display: flex; flex-direction: column; background-color: #f9f9f9;">

		<!-- Chat Messages Area -->
		<div style="flex: 1; padding: 15px; overflow-y: auto;">
			{% for message in discussions %}
				<div style="margin: 10px 0; display: flex; flex-direction: column; align-items: {{ message.sender.username == app.user.username ? 'flex-end' : 'flex-start' }};">
					<div style="padding: 10px; background-color: {{ message.sender.username == app.user.username ? '#dcf8c6' : '#fff' }}; border: 1px solid #ccc; border-radius: 10px; max-width: 70%;">
						<strong>{{ message.sender.username == app.user.username ? 'Moi' : message.sender.username }}:</strong><br>
						{{ message.message }}<br>
						{% if message.image %}
							<img src="{{ asset('uploads/messages/' ~ message.image) }}" alt="Image" style="max-width: 200px; max-height: 200px; margin-top: 10px;">
						{% endif %}
						<small style="color: grey;">{{ message.createdAt|date('H:i') }}</small>
					</div>
				</div>
			{% endfor %}
		</div>

		<!-- Input Bar -->
		<form method="post" enctype="multipart/form-data" style="display: flex; padding: 10px; border-top: 1px solid #ccc; background-color: #fff; align-items: center;">
			<textarea name="message" rows="1" style="flex: 1; resize: none; border: 1px solid #ccc; border-radius: 20px; padding: 10px 15px; margin-right: 10px;" placeholder="Écris ton message..."></textarea>

			<!-- Image Upload Button -->
			<label for="profileImage" style="background-color: #4CAF50; color: white; border: none; border-radius: 50%; width: 45px; height: 45px; display: flex; justify-content: center; align-items: center; cursor: pointer;">
				<img src="{{ asset('uploads/images/add-image.png') }}" alt="Upload Image" title="Upload Image" style="width: 30px; height: 30px; border-radius: 20%;">


			</label>
			<input
			type="file" id="profileImage" name="image" accept="image/*" style="display: none;">

			<!-- Submit Button -->
			<button type="submit" style="background-color: #4CAF50; color: white; border: none; border-radius: 50%; width: 45px; height: 45px; font-weight: bold; cursor: pointer; position: relative;">
				<img src="{{ asset('uploads/images/paper-plane.png') }}" alt="send message" title="send message" style="width: 30px; height: 30px; border-radius: 20%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
			</button>
		</form>
	</div>

	<div style="text-align: center; margin-top: 10px;">
		{% if is_granted('ROLE_ADMIN') %}
			<a href="{{ path('app_admin') }}">← Retour</a>
		{% else %}
			<a href="{{ path('app_user') }}">← Retour</a>
		{% endif %}
	</div>

	<!-- Sidebar (List of Members) -->
	<div style="width: 25%; padding: 10px; background-color: #f1f1f1; border-right: 1px solid #ccc; overflow-y: auto;">
		<h3>Utilisateurs</h3>
		<ul style="list-style: none; padding: 0;">
			{% for member in members %}
				<li style="margin-bottom: 15px; display: flex; align-items: center;">
					{% if member.profileImage %}
						<img src="{{ asset('uploads/profile_images/' ~ member.profileImage) }}" alt="{{ member.username }}'s profile image" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
					{% else %}
						<img src="{{ asset('uploads/profile_images/default-avatar.png') }}" alt="default avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
					{% endif %}
					<a href="{{ path('app_discussion', { 'id': member.id }) }}" style="text-decoration: none; color: black;">
						{{ member.username }}
					</a>
				</li>
			{% endfor %}
		</ul>
	</div>

{% endblock %}
